# BIOS

[[0启动流程]] [[MBR主引导记录]] [[中断]] [[ROM与RAM]]

## 什么是 BIOS

**BIOS (Basic Input/Output System，基础输入输出系统)** 是计算机上第一个运行的软件，存储在主板的 ROM 芯片中。

- **性质**：固件程序（存放在硬件里的软件）
- **位置**：主板上的 ROM/EEPROM/Flash 芯片
- **作用**：初始化硬件 + 提供基础功能接口

## BIOS 是硬件还是软件？

**BIOS 不是硬件，而是存放在硬件里的软件。**

- **硬件部分**：主板上有一块 ROM 芯片
- **软件部分**：BIOS 本身是一段程序，用机器码写成
- CPU 可以直接执行 ROM 中的 BIOS 程序

参见：[[ROM与RAM]]

## BIOS 的作用

### 1. 基本 I/O 功能

负责最底层的硬件操作：

- **输出**：显示字符到屏幕
- **输入**：读取键盘输入
- **存储**：访问硬盘、软盘
- **其他**：设置系统时钟

### 2. 硬件初始化

BIOS 启动时的工作：

```
上电 → POST (自检) → 初始化中断向量表 → 检测硬件 → 引导启动
```

#### POST (Power-On Self Test)

- 检查 CPU、内存、显卡、硬盘等
- 确保硬件正常工作

#### 初始化中断向量表

- 中断向量表位于内存 `0x00000` - `0x003FF` (1KB)
- BIOS 将自己提供的服务例程地址填入 IVT
- 例如：
  - INT 10h → 屏幕显示服务
  - INT 13h → 磁盘读写服务
  - INT 16h → 键盘输入服务

参见：[[中断]]

### 3. 提供统一接口

- 不同厂商的硬件实现差异大
- BIOS 提供统一接口 → 程序不用关心底层差异
- 类似于现代操作系统的驱动程序接口（API）

## BIOS 中断

### 什么是中断？

**中断 (Interrupt)** = CPU 的打断机制

- CPU 正在执行 A 程序
- 硬件/软件发信号："先停一下，有紧急事要处理！"
- CPU 保存现场 → 跳到中断处理程序 → 执行完再回来

### BIOS 中断 = 软件中断

BIOS 提供的一组软件中断服务：

| 中断号 | 功能 |
|-------|------|
| INT 10h | 屏幕显示（清屏、打印字符、设置光标）|
| INT 13h | 磁盘读写 |
| INT 16h | 键盘输入 |

#### 调用过程

```nasm
int 0x10    ; 触发软件中断 10h
```

1. 程序执行 `int xxh` 指令
2. CPU 保存现场（IP、CS 压栈）
3. CPU 查中断向量表（IVT），找到中断号对应的地址
4. 跳转到 BIOS 提供的服务程序执行
5. 执行完毕后返回

### 中断向量表 (IVT)

- **位置**：内存 `0x0000:0000` 开始
- **大小**：1KB
- **结构**：每个中断号占 4 字节（段地址:偏移地址）
- **填充**：由 BIOS 在启动时初始化

#### 为什么需要重新填充？

1. RAM 是易失性存储 → 断电后内容丢失
2. 开机时 IVT 区域是垃圾数据
3. BIOS 必须填充有效的服务程序地址

## 为什么需要 BIOS？

### 1. 操作系统启动前要用

- 开机时，内存里还没有操作系统
- BIOS 提供基础功能，让 CPU 可以：
  - 初始化硬件
  - 读取磁盘上的 [[MBR主引导记录]]
  - 显示开机自检画面

### 2. 兼容老软件

- 早期软件（DOS 程序）直接调用 BIOS 接口
- 如果没有 BIOS，每个硬件型号都不一样，无法写通用程序

### 3. 调试与紧急修复

- 操作系统损坏时，BIOS 接口仍然可用
- 工程师可以用 BIOS 功能做低级调试

## BIOS 启动流程

```
1. CPU 上电，CS:IP = 0xF000:0xFFF0
2. CPU 执行 ROM 中的 BIOS 程序
3. POST 自检
4. 初始化中断向量表
5. 检测启动设备（硬盘、U盘、光驱...）
6. 读取硬盘第 0 扇区（MBR）到内存 0x7C00
7. 检查 MBR 魔数（0x55AA）
8. jmp 0x7C00，将控制权交给 MBR
```

参见：[[0启动流程]]

## 显卡 BIOS

**显卡也有自己的 BIOS**，用来初始化显卡硬件并提供基础功能接口。

- 显卡 BIOS 提供接口：
  - 输出字符：`print_char()`
  - 移动光标：`set_cursor(x, y)`
  - 清屏：`clear_screen()`

- 程序不关心显存地址、寄存器值，只需调用接口

参见：[[显卡]]

## 总结

> **BIOS 是启动、兼容、统一和应急的基石**

| 功能 | 说明 |
|------|------|
| 启动 | 操作系统启动前初始化硬件 |
| 兼容 | 提供统一接口，兼容不同硬件 |
| 统一 | 程序不用关心底层硬件差异 |
| 应急 | OS 损坏时仍可用于调试 |

参见：[[实模式]] [[中断]]
