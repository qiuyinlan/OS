# 总线

[[硬件]] [[南桥北桥芯片]] [[IO接口]]

## 什么是总线

**总线 (Bus)** 是一组电线，用于传送信号，连接计算机中的各种硬件设备。

> 总线就像一条高速公路，这公路上有很多出口可以让汽车进出。

- **本质**：就是把大家连接到一起的电线
- **特点**：公共线路，所有设备共享
- **作用**：让硬件设备之间能够通信

## 总线的物理实现

### 主板上的线路

- 主板上密密麻麻的线路就是总线
- 这些线路是实际的电路走线
- 不是抽象的概念，而是实实在在的电线

### 总线的名称由来

- **Bus = 公共汽车**
- 所有设备共享同一条线路
- 就像公共汽车，大家都可以上下车

## 总线的类型

### 按功能分类

| 总线类型 | 作用 | 宽度 |
|---------|------|------|
| **数据总线** | 传输数据 | 8/16/32/64 位 |
| **地址总线** | 传输地址 | 20/32/36/64 位 |
| **控制总线** | 传输控制信号 | 若干根 |

#### 数据总线

- 传输实际的数据
- **宽度** = CPU 的位数
  - 8 位 CPU → 8 根数据线
  - 32 位 CPU → 32 根数据线
  - 64 位 CPU → 64 根数据线

#### 地址总线

- 传输内存地址或端口号
- **宽度**决定寻址能力
  - 20 根 → 1MB 内存（2^20）
  - 32 根 → 4GB 内存（2^32）
  - 64 根 → 16EB 内存（2^64）

#### 控制总线

- 传输控制信号
- 例如：
  - 读/写信号
  - 中断请求
  - 总线请求/响应
  - 时钟信号

### 按层次分类

```
CPU
 │
 ├── 前端总线 (FSB) ─── 北桥
 │                      │
 │                      ├── 内存总线 ─── 内存
 │                      │
 │                      └── PCI-E 总线 ─── 显卡
 │
 └── (通过北桥连接南桥)
                        南桥
                         │
                         ├── PCI 总线 ─── PCI 设备
                         │
                         ├── SATA 总线 ─── 硬盘
                         │
                         ├── USB 总线 ─── USB 设备
                         │
                         └── LPC 总线 ─── BIOS ROM
```

参见：[[南桥北桥芯片]]

## 总线的工作原理

### 总线仲裁

**问题**：同一时刻，只有一对设备能使用总线。

当多个设备同时想使用总线时，谁先谁后？

**解决**：总线仲裁

- **集中式仲裁**：由仲裁器决定
- **分布式仲裁**：设备之间协商

### 总线时序

设备使用总线要遵循时序：

1. **申请总线**：设备发出总线请求
2. **获得总线**：仲裁器授权
3. **使用总线**：传输数据
4. **释放总线**：传输完成，让出总线

## CPU 通过总线访问外设

### 访问路径

```
CPU → 内部总线 → 南桥 → 外部总线 → IO接口 → 外设
```

#### 内部总线

- CPU 到[[南桥北桥芯片]]的专用总线
- 只通向南桥中的 CPU 接口

#### 外部总线

- 南桥到各种 [[IO接口]] 的总线
- 例如：PCI、SATA、USB

### 南桥的作用

> [[南桥北桥芯片]] 中的"桥"，对应英文 **hub**（集合）

- **仲裁 IO 接口的竞争**
- **连接各种内部总线**
- 集成常用的 IO 接口：
  - SATA（硬盘）
  - USB
  - PCI 设备
  - 电源管理

参见：[[南桥北桥芯片]]

## 常见的总线标准

### PCI (Peripheral Component Interconnect)

- **外设组件互连**
- 连接声卡、网卡等
- 32 位，33MHz
- 带宽：133MB/s

### PCI-E (PCI Express)

- PCI 的升级版
- **串行**总线（不是并行）
- 带宽更高
- 常用于显卡

| PCI-E 版本 | 单通道带宽 | x16 带宽 |
|-----------|----------|---------|
| PCI-E 1.0 | 250MB/s | 4GB/s |
| PCI-E 2.0 | 500MB/s | 8GB/s |
| PCI-E 3.0 | 1GB/s | 16GB/s |
| PCI-E 4.0 | 2GB/s | 32GB/s |

### SATA (Serial ATA)

- **串行 ATA**
- 连接硬盘
- 替代老的 PATA (IDE)

| SATA 版本 | 带宽 |
|----------|------|
| SATA 1.0 | 1.5Gb/s (150MB/s) |
| SATA 2.0 | 3Gb/s (300MB/s) |
| SATA 3.0 | 6Gb/s (600MB/s) |

参见：[[硬盘]]

### USB (Universal Serial Bus)

- **通用串行总线**
- 连接各种外设

| USB 版本 | 带宽 |
|---------|------|
| USB 1.1 | 12Mb/s |
| USB 2.0 | 480Mb/s |
| USB 3.0 | 5Gb/s |
| USB 3.1 | 10Gb/s |
| USB 4.0 | 40Gb/s |

### AGP (Accelerated Graphics Port)

- 加速图形端口
- 老式显卡接口
- 已被 PCI-E 取代

## 总线的演进

### 并行 → 串行

早期总线是**并行**的（多根线同时传输）：
- PCI
- PATA (IDE)

现代总线是**串行**的（单根线或少数线）：
- PCI-E
- SATA
- USB

#### 为什么串行反而更快？

1. **时钟偏移问题**
   - 并行总线：多根线同时传输，时序难对齐
   - 串行总线：单根线，无时序问题

2. **频率提升**
   - 串行可以跑更高的频率
   - 虽然线少，但频率高，总带宽更大

3. **成本降低**
   - 线少，布线简单
   - 抗干扰性能好

## 总线带宽计算

```
带宽 = 频率 × 位宽 ÷ 8
```

### 示例：PCI 总线

- 频率：33MHz
- 位宽：32 位
- 带宽 = 33 × 32 ÷ 8 = 132 MB/s

### 示例：DDR4-3200 内存

- 频率：1600MHz（DDR 双倍数据速率 → 3200MT/s）
- 位宽：64 位
- 带宽 = 3200 × 64 ÷ 8 = 25600 MB/s = 25.6 GB/s

## 总线冲突

### 问题

多个设备同时想使用总线时会冲突。

### 解决方案

#### 1. 时分复用

- 不同设备分时使用
- 由[[南桥北桥芯片]]仲裁

#### 2. 独立总线

- 高速设备用独立总线
- 例如：
  - 显卡用 PCI-E
  - 内存用专用内存总线

#### 3. 总线桥接

- 南桥、北桥作为桥梁
- 连接不同的总线

参见：[[南桥北桥芯片]]

## 总结

### 总线的本质

- **物理实现**：主板上的电线
- **作用**：连接各种硬件设备
- **特点**：公共、共享

### 总线的分类

| 分类方式 | 类型 |
|---------|------|
| 按功能 | 数据总线、地址总线、控制总线 |
| 按层次 | 前端总线、内存总线、PCI、SATA、USB... |
| 按方式 | 并行总线、串行总线 |

### CPU 访问外设

```
CPU → 总线 → 南桥 → 总线 → IO接口 → 外设
```

### 现代总线特点

- **串行化**：PCI-E、SATA、USB
- **高频率**：带宽更大
- **点对点**：减少冲突

参见：[[IO接口]] [[南桥北桥芯片]] [[硬件]]
