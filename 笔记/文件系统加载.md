[[文件系统]]

# ⭐ 第一步：初始化磁盘驱动（IDE/SATA/NVMe）

内核要先能和硬盘“说话”。

- 配置 I/O 端口
    
- 初始化硬盘寄存器
    
- 能发命令
    
- 能读 LBA 扇区
    

这一步完成后：

### ✔ 内核可以读写扇区

### ❌ 但还不知道文件是什么，只能看到一堆 512 字节块

---

# ⭐ 第二步：解析分区表（MBR 或 GPT）

内核开始认识磁盘结构：

- 从 LBA0 读取 MBR
    
- 找到分区起始位置
    
- 记录分区大小
    

此时：

### ✔ 内核知道“这个磁盘从哪里到哪里是一个分区”

### ❌ 但还不知道目录、文件、inode 是什么

---

# ⭐ 第三步：加载具体文件系统（例如 EXT2/FAT32）

文件系统模块开始工作：

- 读取 superblock
    
- 读取 inode 表
    
- 读取目录结构
    
- 建立 VFS 节点
    

这时才第一次出现：

### ✔ `/` 根目录

### ✔ `/bin` `/etc` `/home`

### ✔ 文件、inode、数据块映射

也就是说：

🔥 **文件系统模块初始化完毕的那一刻，OS 才真正“拥有文件系统”。**

---

# ⭐ 第四步：挂载文件系统（Mount）

你常见的：

`mount /`

这一步是操作系统正式宣布：

### “从现在开始，我能用文件了。”

之后：

- `open()`
    
- `read()`
    
- `write()`
    
- `ls`
    
- `cat`
    

这些才能工作。

---

# ⭐ 总结时间轴（超清晰版）

| 阶段                   | 系统是否有文件系统？       |
| -------------------- | ---------------- |
| Bootloader 阶段        | ❌ 没有             |
| 内核刚启动                | ❌ 没有             |
| 内核能读硬盘扇区             | ❌ 还是没有（只是裸扇区）    |
| 内核识别分区表              | ❌ 没有（只是知道分区）     |
| 内核加载文件系统模块（FAT/EXT2） | ⭐快有了             |
| 内核挂载根文件系统 `/`        | ✔ **此时才真正有文件系统** |